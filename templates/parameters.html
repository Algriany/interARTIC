<!DOCTYPE html>
<html lang="en" dir="ltr">
<style>
.tooltip {
  position: relative;
  display: inline-block;
  border-bottom: 1px dotted black;
}

.tooltip .tooltiptext {
  visibility: hidden;
  width: 350px;
  background-color: #555;
  color: #fff;
  text-align: left;
  border-radius: 6px;
  padding: 5px 0;
  position: absolute;
  z-index: 1;
  bottom: 125%;
  left: 50%;
  margin-left: -60px;
  opacity: 0;
  transition: opacity 0.3s;
}

.tooltip .tooltiptext::after {
  content: "";
  position: absolute;
  top: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: #555 transparent transparent transparent;
}

.tooltip:hover .tooltiptext {
  visibility: visible;
  opacity: 1;
}
</style>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="/static/css/bulma.css" />
    <link rel="icon" type="image/png" href="/static/icon.png" sizes="400x400">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script>
      window.onload = function() {
        console.log("loaded window")
        var buttons = document.getElementsByClassName("abort");
        for (var i = 0; i < buttons.length; i++) {
          buttons[i].addEventListener('click', function(){
            console.log("clicked!!!!")
            // alert(this.name);
            var job_name = this.name;
            job_name = job_name.substring(0,job_name.indexOf('?'));
            console.log(job_name);
            var modal = document.getElementById("myModal");
            var close = document.getElementById("close");
            var cancel = document.getElementById("cancel");
            var confirmDel = document.getElementById("confirm");
            var dmodal = document.getElementById("confirmDelete");
            var close2 = document.getElementById("close2");
            var cancel2 = document.getElementById("cancel2");
            var conDel = document.getElementById("confirmD");

            modal.style.display = "block";
            var job = document.getElementById("jobname");
            job.innerHTML = '"' + job_name + '"';
            job.name = job_name;

            close.onclick = function() {
              modal.style.display = "none";
            }
            cancel.onclick = function() {
              modal.style.display = "none";
            }
            confirmDel.onclick = function() {
              modal.style.display = "none";
              dmodal.style.display = "block";
              cancel2.href = "/abort/"+job.name;
              conDel.href = "/abort/delete/"+job.name;
              console.log(cancel2.href);
              console.log(conDel.href);
            }
            close2.onclick = function() {
              dmodal.style.display = "none";
            }
            cancel2.onclick = function() {
              dmodal.style.display = "none";
              // alert(this.name);
            }
          });
        }
      }
    </script>
    <title>Home</title>
</head>
<body>
    {% extends "page_template.html" %}
    {% block content %}
    <!-- Titles -->
    <div class="hero-body">
      {% with messages = get_flashed_messages() %}
				{% if messages %}
					{% for message in messages %}
					<div class="notification is-danger is-light" id="flash">
						<button class="delete" onclick="hide()"></button>
						{{ message }}
					</div>
					{% endfor %}
				{% endif %}
			{% endwith %}

      <div class="container is-widescreen">
        <div class="columns">
          <div class="column is-one-quarter">
            <table class="table is-hoverable is-bordered is-fullwidth">
              <thead>
                  <tr>
                      <th>Queued Jobs</td>
                  </tr>
              </thead>
              <tbody id="jobsQueue">
              </tbody>
          </table>
          </div>
          <div class="column">
              <!-- Start parameter input -->
              <center><h1 class="title is-4">Prepare your InterARTIC job</h1> <br></center>
              <form autocomplete="off" method=POST>
                <div class="field">
                  <div class="control">
                    <!-- Job name input -->
                    <b> * = required </b><br><br>
                    <label class="subtitle is-5" for="job_name">Job name: *</label>
                    <div class="tooltip"> (info)
                        <span class="tooltiptext">Must be unique for each job.</span>
                    </div><br>
                    <input class="input" id="job_name" name="job_name" type="text" placeholder="Job Name" value="{{ job_name }}" required>
                    {% if errors %}
                        {% if errors['job_name'] %}
                            <script>
                              document.getElementById("job_name").className = "input is-danger";
                            </script>
                            <p class="help is-danger"> {{ errors['job_name'] }} </p>
                        {% endif %}
                        {% if errors['char_error_job_name'] %}
                            <script>
                              document.getElementById("job_name").className = "input is-danger";
                            </script>
                            <p class="help is-danger"> {{ errors['char_error_job_name'] }} </p>
                        {% endif %}
                    {% endif %}
                  </div>
                </div>
                <label class="subtitle is-5">Select the input data directory for your experiment: *</label><br>
                  <input class="input" list="search" name="input_folder" id="input_folder" placeholder="Search for input folder" value="{{input_name}}" autocomplete="off" required>
                    <datalist id="search">
                      {% if folders %}
                        {% for folder in folders %}
                          <option value="{{ folder }}">{{ folder }}</option>
                        {% endfor %}
                      {% endif %}
                      {% if errors %}
                          {% if errors['char_error_input_folder'] %}
                              <script>
                                document.getElementById("input_folder").className = "input is-danger";
                              </script>
                              <p class="help is-danger"> {{ errors['char_error_input_folder'] }} </p>
                          {% endif %}
                          {% if errors['input_folder'] %}
                              <script>
                                document.getElementById("input_folder").className = "input is-danger";
                              </script>
                              <p class="help is-danger"> {{ errors['input_folder'] }} </p>
                          {% endif %}
                      {% endif %}
                    </datalist>
                <br>
                <script>
                  function getMultiSample(id) {
                    if (id == "multiple") {
                        document.getElementById("multi_sample").style.display = "block";
                        }
                    else {
                        document.getElementById("multi_sample").style.display = "none";
                        }
                    }
                </script>
                <div class="field">
                  <div class="control">
                    <!-- single or multiple samples -->
                    <br>
                    <h1 class="subtitle">This input contains: *</h1>
                    <input type="radio" id="single" name="num_samples" value="single" onClick="getMultiSample(this.id)" required>
                    <label for="single">A single sample</label><br>
                    <input type="radio" id="multiple" name="num_samples" value="multiple" onClick="getMultiSample(this.id)">
                    <label for="multiple">Multiple samples</label><br><br>
                    {% if num_samples %}
                    <script>
                        document.getElementById("{{num_samples}}").checked = true;
                        // getMultiSample("{{num_samples}}")
                    </script>
                    {% endif %}
                  </div>
                    <div id="multi_sample" style="display:none">
                        <!-- select sample-csv -->
                        <label class="subtitle is-5">Select the sample-barcode metadata file (CSV) for your experiment: </label><br>
                        <small>(Only needed if there are multiple samples)</small><br>
                          <input class="input" list="csv_search" name="csv_file" id="csv_file" placeholder="Search for CSV file" value="{{csv_name}}" autocomplete="off">
                            <datalist id="csv_search">
                              {% if csvs %}
                                {% for csv in csvs %}
                                  <option value="{{ csv }}">{{ csv }}</option>
                                {% endfor %}
                              {% endif %}
                              {% if num_samples %}
                              <script>
                                  // document.getElementById("{{num_samples}}").checked = true
                                  getMultiSample("{{num_samples}}")
                              </script>
                              {% endif %}
                              {% if errors %}
                                {% if errors['csv_file'] %}
                                <script>
                                  document.getElementById("csv_file").className = "input is-danger";
                                </script>
                                <p class="help is-danger"> {{ errors['csv_file'] }} </p>
                                {% endif %}
                              {% endif %}
                            </datalist>
                       </div><br>
                <!-- Hiding this for now, as it's a bit confusing -->
                <div id="concat_fastq" style="display:none">
                  <label class="subtitle is-5" for="scheme_folder">Select concatenated fastq file (optional):</label>
                  <div class="tooltip"> (info)
                      <span class="tooltiptext">- If you already have a concatenated fastq file/s you may specify it here. Otherwise, this will be generated by the artic gather/demultiplex functions<br><br>
                                                - Must be absolute file path, starting with "/"</span>
                      </div><br>
                  <!-- <small>(only input if you already have this file, otherwise artic gather/demultiplex will generate it)</small><br> -->
                  <input class="input" type="text" id="read_file" name="read_file" size="80" value="{{read_file}}"><br>
                  {% if errors %}
                      {% if errors['read_file'] %}
                          <script>
                            document.getElementById("read_file").className = "input is-danger";
                          </script>
                          <p class="help is-danger"> {{ errors['read_file'] }} </p>
                      {% endif %}
                      {% if errors['char_error_read_file'] %}
                          <script>
                            document.getElementById("read_file").className = "input is-danger";
                          </script>
                          <p class="help is-danger"> {{ errors['char_error_read_file'] }} </p>
                      {% endif %}
                  {% endif %}
                  <br>
              </div>

                  <!-- output folder file path - Medaka/ Nanopolish-->
                  <label class="subtitle is-5" for="output_folder">Output folder (optional): </label>
                  <div class="tooltip"> (info)
                      <span class="tooltiptext">- Must be absolute file path, starting with "/" or single folder name to be created in input folder</span>
                  </div><br>
                  <small>(if no output folder is provided, one will be created inside the input folder)</small><br>
                  <input class="input" type="text" id="output_folder" name="output_folder" size="80" value="{{output_folder}}"><br>
                  {% if errors %}
                      {% if errors['char_error_output_folder'] %}
                          <script>
                            document.getElementById("output_folder").className = "input is-danger";
                          </script>
                          <p class="help is-danger"> {{ errors['char_error_output_folder'] }} </p>
                      {% endif %}
                      {% if errors['override'] == True %}
                          <script>
                            document.getElementById("output_folder").classList.add("is-danger");
                          </script>
                      {% endif %}
                  {% endif %}
                  <br>
                  <!-- override output data?-->
                  <input type="checkbox" id="override_data" name="override_data">
                  <label for="override_data">Override existing data?</label><br>
                  {% if override_data %}
                    <script>
                        document.getElementById("override_data").checked = true;
                    </script>
                  {% endif %}

                  </div>
                   <!-- refernce genome -->
                  <script>
                  function getReference(id) {
                    if (id == "SARS-CoV-2") {
                        document.getElementById("SARS-CoV-2_virus").style.display = "block";
                    } else {
                        document.getElementById("SARS-CoV-2_virus").style.display = "none";
                        // setSchemes("none", "")
                        }
                    if (id == "IturiEBOV") {
                        document.getElementById("IturiEBOV_virus").style.display = "block";
                        }
                    else {
                        document.getElementById("IturiEBOV_virus").style.display = "none";
                        }
                    }

                  function getOtherPrimer(id) {
                    if (id == "custom") {
                        document.getElementById("other_primer").style.display = "block";
                        // setSchemes("none", "")
                    } else {
                        document.getElementById("other_primer").style.display = "none";
                    }
                    }

                  </script>
                  <div class="field">
                    <div class="control">
                      <!-- Which virus/reference -->
                      <br>
                      <h1 class="subtitle">Select the virus you want to analyse: *</h1>
                      <input type="radio" id="SARS-CoV-2" name="virus" value="SARS-CoV-2" onClick="getReference(this.id), getOtherPrimer(this.id), setSchemes(this.id, {{schemes}})" required>
                      <label for="SARS-CoV-2">SARS-CoV-2 (nCoV-2019)</label><br>
                      <input type="radio" id="IturiEBOV" name="virus" value="IturiEBOV" onClick="getReference(this.id), getOtherPrimer(this.id), setSchemes(this.id, {{schemes}})">
                      <label for="IturiEBOV">IturiEBOV</label><br>
                      <input type="radio" id="custom" name="virus" value="custom" onClick="getReference(this.id), getOtherPrimer(this.id), setSchemes(this.id, {{schemes}})">
                      <label for="custom">Custom</label><br><br>
                    </div>
                      <div id="SARS-CoV-2_virus" style="display:none">
                          <!-- nCoV-2019 primer schemes -->
                            <label class="subtitle is-5" for="primer_type"> Select your primer scheme: *</label>
                            <div class="tooltip"> (info)
                                <span class="tooltiptext">There are 3 default primer sets available with interArtic:<br>
                                                          - <b>artic:</b> The original 400bp amplicon set, great for high CT samples<br>
                                                          - <b>eden:</b> 2500bp amplicon set used for gaining even coverage depth<br>
                                                          - <b>midnight:</b> 1200bp amplicon set used for striking a balance between above 2</span>
                            </div><br><br>
                            <input type="radio" id="nCoV_2019_artic_V1" name="primer_type" value="nCoV_2019_artic_V1" onclick="setSchemes(this.id, {{schemes}}), getOtherPrimer(this.id)">
                            <label for="nCoV_2019_artic_V1"> Artic V1 (400bp)</label><br>
                            <input type="radio" id="nCoV_2019_artic_V2" name="primer_type" value="nCoV_2019_artic_V2" onclick="setSchemes(this.id, {{schemes}}), getOtherPrimer(this.id)">
                            <label for="nCoV_2019_artic_V2"> Artic V2 (400bp)</label><br>
                            <input type="radio" id="nCoV_2019_artic_V3" name="primer_type" value="nCoV_2019_artic_V3" onclick="setSchemes(this.id, {{schemes}}), getOtherPrimer(this.id)">
                            <label for="nCoV_2019_artic_V3"> Artic V3 (400bp)</label><br>
                            <input type="radio" id="nCoV_2019_eden_V1" name="primer_type" value="nCoV_2019_eden_V1" onclick="setSchemes(this.id, {{schemes}}), getOtherPrimer(this.id)">
                            <label for="nCoV_2019_eden_V1"> Eden V1 (2500bp)</label><br>
                            <input type="radio" id="nCoV_2019_midnight_V1" name="primer_type" value="nCoV_2019_midnight_V1" onclick="setSchemes(this.id, {{schemes}}), getOtherPrimer(this.id)">
                            <label for="nCoV_2019_midnight_V1"> Midnight V1 (1200bp)</label><br>
                            <!-- <input type="radio" id="other" name="primer_type" value="other" onClick="getOtherPrimer(this.id)">
                            <label for="other">Other</label><br> -->
                       </div>
                      <div id="IturiEBOV_virus" style="display:none">
                          <!-- ebola_virus primer schemes -->
                            <label class="subtitle is-5" for="primer_type"> Select your primer scheme: *</label>
                            <!-- <div class="tooltip"> (info)
                                <span class="tooltiptext"></span>
                            </div> -->
                            <br><br>
                            <input type="radio" id="IturiEBOV_artic_V1" name="primer_type" value="IturiEBOV_artic_V1" onclick="setSchemes(this.id, {{schemes}}), getOtherPrimer(this.id)">
                            <label for="IturiEBOV_artic_V1"> Artic V1 (400bp)</label><br>
                            <!-- <input type="radio" id="other" name="primer_type" value="other" onClick="getOtherPrimer(this.id)">
                            <label for="other">Other</label><br> -->
                       </div>
                       {% if virus %}
                        <script>
                           document.getElementById("{{virus}}").checked = true
                           getReference("{{virus}}")
                        </script>
                       {% endif %}
                       {% if primer_type %}
                        <script>
                            document.getElementById("{{primer_type}}").checked = true
                        </script>
                       {% endif %}
                   </div>
                   <div class="field">
                     <div class="control">
                       <div id="other_primer" style="display:none">
                           Please enter your custom primer here:
                           <input class="input" type="text" id="other_primer_type" name="other_primer_type" value={{other_primer_type}}>
                       </div><br>

                          <!-- primer scheme directory -->
                          <label class="subtitle is-5" for="primer_scheme">Primer scheme directory: *</label><br>
                          <input class="input" type="text" id="primer_scheme_dir" name="primer_scheme_dir" size="60" value="{{primer_scheme_dir}}" required><br>
                          {% if errors %}
                              {% if errors['primer_scheme_dir'] %}
                                  <script>
                                    document.getElementById("primer_scheme_dir").className = "input is-danger";
                                  </script>
                                  <p class="help is-danger"> {{ errors['primer_scheme_dir'] }} </p>
                              {% endif %}
                              {% if errors['char_error_primer_scheme_dir'] %}
                                  <script>
                                    document.getElementById("primer_scheme_dir").className = "input is-danger";
                                  </script>
                                  <p class="help is-danger"> {{ errors['char_error_primer_scheme_dir'] }} </p>
                              {% endif %}
                          {% endif %}
                          <br>

                          <!-- primer scheme name -->
                          <label class="subtitle is-5" for="primer_scheme">Name of primer scheme: *</label><br>
                          <small> e.g. nCoV-2019/V3 </small><br>
                          <input class="input" type="text" id="primer_scheme" name="primer_scheme" size="30" value="{{primer_scheme}}" required><br>
                     </div>
                 </div>

                    <div class="field">
                      <div class="control">
                        <!-- barcode type -->
                        <br>
                        <label class="subtitle is-5" for="barcode_type">Which library preparation method was used: *</label><br><br>
                        <input type="radio" id="native" name="barcode_type" value="native" onclick="setParams()">
                        <label for="native">Ligation library prep (eg SQK-LSK109)</label><br>
                        <input type="radio" id="rapid" name="barcode_type" value="rapid" onclick="setParams()">
                        <label for="rapid">Rapid library prep (eg SQK-RBK004)</label><br><br>
                        {% if barcode_type %}
                         <script>
                             document.getElementById("{{barcode_type}}").checked = true
                         </script>
                        {% endif %}


                <label class="subtitle is-5" for="pipeline"> Select a pipeline to run: *</label>
                    <div class="tooltip"> (info)
                        <span class="tooltiptext">- The Nanopolish pipeline uses both .fastq and .fast5 files for variant calling<br><br>
                                                  - The Medaka pipeline only uses .fastq files for variant calling<br><br>
                                                  - Both will run each pipeline, one after the other</span>
                    </div><br><br>
                    <input type="radio" id="nanopolish" name="pipeline" value="nanopolish">
                    <label for="nanopolish"> Nanopolish</label><br>
                    <input type="radio" id="medaka" name="pipeline" value="medaka">
                    <label for="medaka"> Medaka</label><br>
                    <input type="radio" id="both" name="pipeline" value="both">
                    <label for="both"> Both</label><br>
                    {% if pipeline %}
                     <script>
                         document.getElementById("{{pipeline}}").checked = true
                     </script>
                    {% endif %}
                <br>
                </div>

              </div>

                <div class="field">
                  <div class="control">
                    <!-- Parameter selection -->
                    <!--when medaka is selected then the current parameters appear-->
                    <!-- threads - Medaka/ Nanopolish-->
                    <input type="button" class="button is-small" name="answer" value="Customise your parameters *for advanced users*" onclick="showDiv()" />
                    <div id="paramDiv" style="display: none"><br>
                      {% if errors %}
                        <script>
                          document.getElementById("paramDiv").style.display = "block";
                        </script>
                      {% endif%}
                        <div class="field">
                          <div class="control">
                            <center><h1 class="subtitle"><b>Customise your parameters *for advanced users*</b></h1></center><br>
                            <h1 class="subtitle is-5">Gather command: *</h1>

                            <label for="min_length">Minimum Length: *</label>
                            <input class="input" type="number" id="min_length" name="min_length" value="{{ min_length }}" required><br>
                            <br><label for="max_length">Maximum Length: *</label>
                            <input class="input" type="number" id="max_length" name="max_length" value="{{ max_length }}" required><br>
                            {% if errors %}
                                {% if errors['invalid_length'] %}
                                  <script>
                                    document.getElementById("min_length").className = "input is-danger";
                                    document.getElementById("max_length").className = "input is-danger";
                                  </script>
                                  <p class="help is-danger"> {{ errors['invalid_length'] }} </p>
                                {% endif %}
                                {% if errors['char_error_min_length'] %}
                                    <script>
                                      document.getElementById("min_length").className = "input is-danger";
                                    </script>
                                    <p class="help is-danger"> {{ errors['char_error_min_length'] }} </p>
                                {% endif %}
                                {% if errors['char_error_max_length'] %}
                                    <script>
                                      document.getElementById("max_length").className = "input is-danger";
                                    </script>
                                    <p class="help is-danger"> {{ errors['char_error_max_length'] }} </p>
                                {% endif %}
                            {% endif %}
                            <br>
                            <h1 class="subtitle is-5">Other parameters: *</h1>
                            <label for="num_threads">CPU thread usage: *</label>
                            <input class="input" type="number" id="num_threads" name="num_threads" value="4" required><br>
                            <!-- normalise - Medaka/ Nanopolish-->
                            <br>
                            <label for="normalise">Normalise depth: *</label>
                            <input class="input" type="number" id="normalise" name="normalise" value="200" required><br>
                        </div>
                      </div>
                  </div>
                  <script>
                      function showDiv() {
                        if (document.getElementById('paramDiv').style.display == "block") {
                          document.getElementById('paramDiv').style.display = "none";
                        } else {
                          document.getElementById('paramDiv').style.display = "block";
                        }
                      }
                  </script>
                  </div>
                </div>


                <br>
                <div class="field">
                    <div class="control">
                        {% if errors %}
                        {% if errors['full_queue'] %}
                        <p class="has-text-danger"> {{ errors['full_queue'] }} </p>
                        {% endif %}
                        {% endif %}
                        <br>
                        <input class="button" id="submit_job" name="submit_job" type="submit" value="Submit Job(s)"><br>
                    </div>
                </div>
                <br>
              </form>
            </div>
          </div>
        </div>
        <!-- modal -->
      <div class="modal" id="myModal">
        <div class="modal-background"></div>
        <div class="modal-card">
          <header class="modal-card-head">
            <p class="modal-card-title">Abort Job</p>
            <button id="close" class="delete" aria-label="close"></button>
          </header>
          <section class="modal-card-body">
          Are you sure you want to ABORT <p id="jobname" style="display:inline"></p>?
          </section>
          <footer class="modal-card-foot">
            <button id="confirm" class="button is-success">Yes</button>
            <button id="cancel" class="button">Cancel</button>
          </footer>
        </div>
      </div>

      <div class="modal" id="confirmDelete">
        <div class="modal-background"></div>
        <div class="modal-card">
          <header class="modal-card-head">
            <p class="modal-card-title">Abort Job</p>
            <button id="close2" class="delete" aria-label="close"></button>
          </header>
          <section class="modal-card-body">
          Do you want to delete the files created from the run?
          </section>
          <footer class="modal-card-foot">
            <a id="confirmD" class="button is-success">Yes</a>
            <a id="cancel2" class="button is-danger">No</a>
          </footer>
        </div>
      </div>
      <!-- // -->
      </div>
      </div>

      <script>
        //primers
        // nCoV-2019
        var nCoV_2019_artic_V1 = document.getElementById("nCoV_2019_artic_V1");
        var nCoV_2019_artic_V2 = document.getElementById("nCoV_2019_artic_V2");
        var nCoV_2019_artic_V3 = document.getElementById("nCoV_2019_artic_V3");
        var nCoV_2019_eden_V1 = document.getElementById("nCoV_2019_eden_V1");
        var nCoV_2019_midnight_V1 = document.getElementById("nCoV_2019_midnight_V1");
        // IturiEBOV Ebola
        var IturiEBOV_artic_V1 = document.getElementById("IturiEBOV_artic_V1");
        //barcodes
        var native = document.getElementById("native");
        var rapid = document.getElementById("rapid");

        function setSchemes(id, schemesJson) {
          // if (document.getElementById("other_primer").style.display == "block") {
          //   document.getElementById("other_primer").style.display = "none";
          //
          // }
          var primer_scheme_dir = document.getElementById("primer_scheme_dir");
          var primer_scheme= document.getElementById("primer_scheme");
          if (id == 'nCoV_2019_artic_V1') {
            primer_scheme_dir.value = schemesJson['nCoV_2019_artic_V1_scheme'];
            primer_scheme.value = schemesJson['nCoV_2019_artic_V1_scheme_name'];
        } else if (id == 'nCoV_2019_artic_V2') {
            primer_scheme_dir.value = schemesJson['nCoV_2019_artic_V2_scheme'];
            primer_scheme.value = schemesJson['nCoV_2019_artic_V2_scheme_name'];
        } else if (id == 'nCoV_2019_artic_V3') {
            primer_scheme_dir.value = schemesJson['nCoV_2019_artic_V3_scheme'];
            primer_scheme.value = schemesJson['nCoV_2019_artic_V3_scheme_name'];
        } else if (id == 'nCoV_2019_eden_V1') {
            primer_scheme_dir.value = schemesJson['nCoV_2019_eden_V1_scheme'];
            primer_scheme.value = schemesJson['nCoV_2019_eden_V1_scheme_name'];
        } else if (id == 'nCoV_2019_midnight_V1') {
            primer_scheme_dir.value = schemesJson['nCoV_2019_midnight_V1_scheme'];
            primer_scheme.value = schemesJson['nCoV_2019_midnight_V1_scheme_name'];
        } else if (id == 'IturiEBOV_artic_V1') {
            primer_scheme_dir.value = schemesJson['IturiEBOV_artic_V1_scheme'];
            primer_scheme.value = schemesJson['IturiEBOV_artic_V1_scheme_name'];
        } else if (id == "SARS-CoV-2" || id == "IturiEBOV" || id == "custom") {
              // resets the fields so there isn't any hidden carry over
              primer_scheme_dir.value = "";
              primer_scheme.value = "";
              document.getElementById("nCoV_2019_artic_V1").checked = false
              document.getElementById("nCoV_2019_artic_V2").checked = false
              document.getElementById("nCoV_2019_artic_V3").checked = false
              document.getElementById("nCoV_2019_eden_V1").checked = false
              document.getElementById("nCoV_2019_midnight_V1").checked = false
              document.getElementById("IturiEBOV_artic_V1").checked = false
              if (id != "custom"){
                  var other_primer_type = document.getElementById("other_primer_type")
                  other_primer_type.value = ""
              }
              // document.getElementById("other").checked = false
          }
          setParams()
        }
        // TODO: Do this better, and push it into a config file somewhere
        // Better, yet, calculate it based on amplicon lengths from primer bed scheme
        //max/min length
        function setParams() {
          var max_length = document.getElementById("max_length");
          var min_length = document.getElementById("min_length");
          if((nCoV_2019_artic_V1.checked || nCoV_2019_artic_V2.checked || nCoV_2019_artic_V3.checked) && native.checked) {
            max_length.value = '500';
            min_length.value = '300';
        } else if (nCoV_2019_eden_V1.checked && native.checked) {
            max_length.value = '2700';
            min_length.value = '2300';
        } else if (nCoV_2019_eden_V1.checked && rapid.checked) {
            max_length.value = '2700';
            min_length.value = '300';
        } else if (nCoV_2019_midnight_V1.checked && native.checked) {
            max_length.value = '1400';
            min_length.value = '1000';
        } else if (nCoV_2019_midnight_V1.checked && rapid.checked) {
            max_length.value = '1400';
            min_length.value = '300';
        } else if (IturiEBOV_artic_V1.checked && native.checked) {
            max_length.value = '800';
            min_length.value = '400';
          } else {
            max_length.value = '';
            min_length.value = '';
          }
        }
        function hide() {
          var message = document.getElementById("flash");
          message.style.display = "none";
        }

        // Displaying the Queue
        const jobsQueue = document.getElementById("jobsQueue");

         var jobsJson = JSON.parse({{ queue|tojson|safe }});
         console.log("Jobs Queue: ", jobsJson);

         if (jobsJson != null) {
             var jobs = jobsJson.jobs;
             jobs.forEach(job => {
                 for (var key of Object.keys(job)) {
                     const curJobRow = document.createElement("tr");
                     const curJob = document.createElement("td");
                     const linkNode = document.createElement("a");
                     const textNode = document.createTextNode(key);
                     linkNode.href = job[key];

                     const btn = document.createElement("a");
                     btn.innerHTML = "Abort";
                     btn.classList.add("button");
                     btn.classList.add("is-danger");
                     btn.classList.add("is-light");
                     btn.style = "float:right";
                     btn.classList.add("abort")
                     btn.name = job[key].replace("/progress/", "")

                     linkNode.appendChild(textNode);
                     curJob.appendChild(linkNode);
                     curJob.appendChild(btn);
                     curJobRow.appendChild(curJob);
                     jobsQueue.appendChild(curJobRow);
                 };
             });
         } else {
             const curJobRow = document.createElement("tr");
             const curJob = document.createElement("td");
             const textNode = document.createTextNode("You currently have no queued jobs.");
             curJob.classList.add("has-text-grey-light");
             curJob.classList.add("is-italic");

             curJob.appendChild(textNode);
             curJobRow.appendChild(curJob);
             jobsQueue.appendChild(curJobRow);
         };
        </script>

    {% endblock %}
</body>
</html>
